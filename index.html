<!doctype html>
<html lang="ja" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã‚«ãƒ¢ãƒã‚¤ãƒˆï½œâ€œå…¥ã£ã¦ã¿ãªã„ã¨åˆ†ã‹ã‚‰ãªã„æ¥½ã•â€ã‚’å¯è¦–åŒ–</title>
  <meta name="description" content="ä¼‘æ†©ãŒå¤šã„ãƒ»ã‚¹ãƒãƒ›OKãƒ»å–«ç…™OKãªã©â€œè£ã®æ¥½ã•â€ã§æ¢ã›ã‚‹ã‚¢ãƒ«ãƒã‚¤ãƒˆå£ã‚³ãƒŸãƒŸãƒ‹ã‚¢ãƒ—ãƒªï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜MVPï¼‰ã€‚"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0a0a0a; --panel:#111214; --muted:#9aa0ac; --text:#f8fafc;
      --brand:#ff3b30; /* Red dominant */
      --brand2:#ffb800; /* Yellow accent */
      --accent:#ffd166; --card:#15161a; --border:#242628; --glass:rgba(14,14,16,.65);
    }
    [data-theme="light"]{
      --bg:#fff8f6; --panel:#ffffff; --muted:#667085; --text:#1c1d1f;
      --brand:#ff3b30; --brand2:#ffb800; --accent:#ff7a00; --card:#ffffff; --border:#e7e7ea; --glass:rgba(255,255,255,.75);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:"Poppins","Inter","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";background:
      radial-gradient(1200px 600px at -10% -10%, rgba(255,59,48,.15), transparent 55%),
      radial-gradient(900px 500px at 130% 10%, rgba(255,184,0,.15), transparent 60%),
      linear-gradient(180deg,#0a0a0a,#0b0c0f 30%, #0b0c10);
      color:var(--text)}
    a{color:var(--brand);text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:20px}

    header{position:sticky;top:0;backdrop-filter:blur(14px);background:var(--glass);border-bottom:1px solid var(--border);z-index:5}
    .nav{display:flex;gap:16px;align-items:center;justify-content:space-between}
    .logo{display:flex;gap:10px;align-items:center;font-weight:900;letter-spacing:.4px}
    .logo .badge{background:conic-gradient(from 180deg at 50% 50%, var(--brand), var(--brand2), var(--brand));color:#0a0a0a;padding:8px 12px;border-radius:12px;font-weight:900;box-shadow:0 10px 30px rgba(255,59,48,.35)}
    .tagline{color:var(--muted);font-size:.95rem}
    .cta{display:flex;gap:10px}
    .btn{border:1px solid var(--border);background:var(--panel);color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700;letter-spacing:.2px;transition:.18s transform,.18s box-shadow,.18s background,.18s border}
    .btn:hover{transform:translateY(-1px);box-shadow:0 10px 26px rgba(255,59,48,.25),0 4px 10px rgba(0,0,0,.35)}
    .btn.primary{border-color:transparent;background:linear-gradient(90deg,var(--brand),var(--brand2));color:#000}
    .btn.ghost{background:transparent}
    .btn:disabled{opacity:.5;cursor:not-allowed}

    .hero{padding:44px 0 20px;display:grid;grid-template-columns:1.3fr .7fr;gap:20px}
    .hero h1{font-weight:900;line-height:1.05;margin:.2em 0;font-size:clamp(30px,5.2vw,48px);letter-spacing:.2px}
    .hero h1::after{content:"";display:block;width:120px;height:5px;background:linear-gradient(90deg,var(--brand),var(--brand2));border-radius:8px;margin-top:10px}
    .hero p{color:var(--muted);font-size:1rem}
    .hero .card{background:linear-gradient(180deg,rgba(20,22,26,.8),rgba(12,13,16,.8));border:none;border-radius:22px;padding:20px;box-shadow:0 28px 60px rgba(255,59,48,.12), 0 8px 24px rgba(0,0,0,.45);backdrop-filter:blur(8px)}
    [data-theme="light"] .hero .card{background:#fff}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:900px){.hero{grid-template-columns:1fr}.grid{grid-template-columns:1fr}}

    .section-title{margin:20px 0 8px;font-weight:900;letter-spacing:.2px}

    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;box-shadow:0 14px 40px rgba(255,59,48,.06), inset 0 1px 0 rgba(255,255,255,.03)}
    .hint{color:var(--muted);font-size:.9rem}
    .kbd{border:1px solid var(--border);background:#0f1016;padding:2px 6px;border-radius:6px}
    [data-theme="light"] .kbd{background:#f3f4f6}

    form .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    form .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    form .row4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    @media (max-width:700px){form .row,form .row3,form .row4{grid-template-columns:1fr}}
    label{font-weight:700;font-size:.95rem;margin:10px 0 6px;display:block}
    input,select,textarea{width:100%;background:#0e0f12;border:1px solid var(--border);border-radius:12px;padding:10px;color:var(--text);font:inherit}
    input:focus,select:focus,textarea:focus{outline:2px solid rgba(255,59,48,.5)}
    textarea{min-height:88px;resize:vertical}
    [data-theme="light"] input,[data-theme="light"] select,[data-theme="light"] textarea{background:#fff}

    .filters{display:grid;grid-template-columns:1.1fr .9fr .9fr .9fr;gap:10px;margin:10px 0}
    @media (max-width:900px){.filters{grid-template-columns:1fr 1fr;}}

    .list{display:grid;gap:10px;margin-top:10px}
    .item{display:grid;grid-template-columns:1fr 160px;gap:14px;border:none;background:linear-gradient(180deg,rgba(22,24,28,.9),rgba(14,15,18,.9));border-radius:18px;padding:16px;position:relative;overflow:hidden;box-shadow:0 22px 50px rgba(0,0,0,.55), 0 12px 26px rgba(255,59,48,.10)}
    .item::after{content:"";position:absolute;inset:auto -10% -60% -10%;height:120%;background:radial-gradient(420px 140px at 50% 0, rgba(255,59,48,.18), transparent 72%);pointer-events:none}
    [data-theme="light"] .item{background:#fff}
    @media (max-width:700px){.item{grid-template-columns:1fr}}
    .item h3{margin:0 0 4px;font-size:1.06rem}
    .badges{display:flex;flex-wrap:wrap;gap:6px}
    .badge{border:1px solid var(--border);background:#14151a;color:#e7e9ee;padding:4px 8px;border-radius:10px;font-size:.78rem;white-space:nowrap}
    [data-theme="light"] .badge{background:#f6f7fb;color:#475569}
    .badge.tag{background:linear-gradient(90deg,rgba(255,59,48,.18),rgba(255,184,0,.18));color:var(--text);border-color:transparent}

    .scorewrap{display:flex;align-items:center;justify-content:center}
    .score{--val:72; width:118px;height:118px;border-radius:50%;display:grid;place-items:center;position:relative}
    .score::before{content:"";position:absolute;inset:0;border-radius:50%;background:
      conic-gradient(var(--brand) calc(var(--val)*1%), rgba(128,128,128,.2) 0);
      mask:radial-gradient(circle 48px, #0000 58%, #000 59%);} 
    .score b{font-size:1.35rem;color:#fff}

    .actions{display:flex;gap:8px;margin-top:8px}

    .empty{padding:16px;border:1px dashed var(--border);border-radius:12px;color:var(--muted);text-align:center}

    footer{color:var(--muted);text-align:center;padding:22px 0 70px}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="logo"><span class="badge">ã‚«ãƒ¢</span><span>ãƒã‚¤ãƒˆ</span></div>
      <div class="cta">
        <button class="btn ghost" id="btnTheme" title="ãƒ†ãƒ¼ãƒåˆ‡æ›¿">ğŸŒ— ãƒ†ãƒ¼ãƒ</button>
        <button class="btn ghost" id="btnExport" title="JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ">ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›</button>
        <button class="btn" id="btnImport" title="JSONã‚¤ãƒ³ãƒãƒ¼ãƒˆ">ãƒ‡ãƒ¼ã‚¿èª­è¾¼</button>
        <button class="btn primary" id="btnMock">ã‚µãƒ³ãƒ—ãƒ«æŠ•å…¥</button>
      </div>
    </div>
  </header>

  <div class="container hero">
    <div>
      <h1>â€œå…¥ã£ã¦ã¿ãªã„ã¨åˆ†ã‹ã‚‰ãªã„æ¥½ã•â€ã‚’ã€ã¿ã‚“ãªã§è¦‹ãˆã‚‹åŒ–ã€‚</h1>
      <p class="tagline">ä¼‘æ†©ãŒå¤šã„ã€ã‚¹ãƒãƒ›OKã€å–«ç…™OKã€åº—é•·ã‚†ã‚‹ã„ã€äººé–“é–¢ä¿‚ã¬ã‚‹ã„â€¦ãªã© â€œã‚†ã‚‹ã•æŒ‡æ¨™â€ã§æ¤œç´¢ã§ãã‚‹åŒ¿åå£ã‚³ãƒŸã‚¢ãƒ—ãƒªã®MVPï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰ã€‚
      <br><small>â€»ä»Šã¯ã‚ãªãŸã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ã®ã¿ä¿å­˜ã€‚ã‚µãƒ¼ãƒãƒ¼ä¸è¦ã§ãã®ã¾ã¾å…¬é–‹OKã€‚</small></p>
      <div class="grid">
        <div class="card">
          <div class="section-title">ğŸ” æ¡ä»¶ã§æ¢ã™</div>
          <div class="filters">
            <input id="q" placeholder="ã‚¨ãƒªã‚¢ãƒ»åº—åãƒ»æ¥­ç¨®ã§æ¤œç´¢ï¼ˆä¾‹ï¼šæ¢…ç”° ã‚«ãƒ•ã‚§ï¼‰" />
            <select id="fPhone"><option value="">ã‚¹ãƒãƒ›</option><option>å¸¸æ™‚OK</option><option>ä¼‘æ†©ã®ã¿</option><option>ä¸å¯</option></select>
            <select id="fSmoke"><option value="">å–«ç…™</option><option>åº—å†…OK</option><option>å±‹å¤–OK</option><option>ä¸å¯</option></select>
            <select id="fSort">
              <option value="score">ã‚¹ã‚³ã‚¢é«˜ã„é †</option>
              <option value="new">æ–°ç€é †</option>
              <option value="break">ä¼‘æ†©é•·ã„é †</option>
            </select>
          </div>
          <div class="filters">
            <label>æœ€ä½ã‚¹ã‚³ã‚¢
              <input type="range" id="minScore" min="0" max="100" value="0" />
            </label>
            <label>ä¼‘æ†©ï¼ˆåˆ†/æ™‚çµ¦1hã‚ãŸã‚Šï¼‰ä»¥ä¸Š
              <input type="number" id="minBreak" placeholder="ä¾‹: 15" min="0" />
            </label>
            <label>å¿™ã—ã•ï¼ˆ1=ãƒ’ãƒã€œ5=æ¿€å‹™ï¼‰æœ€å¤§
              <input type="number" id="maxBusy" placeholder="5" min="1" max="5" />
            </label>
            <label>ä¸¦ã³æ›¿ãˆ
              <select id="limit"><option value="50">50ä»¶</option><option value="200">200ä»¶</option><option value="9999">å…¨ä»¶</option></select>
            </label>
          </div>
          <div class="list" id="list"></div>
          <div class="empty" id="empty" style="display:none">è©²å½“ãªã—ã€‚ãƒ•ã‚£ãƒ«ã‚¿ã‚’ã‚†ã‚‹ã‚ã¦ã¿ã¦ã­ã€‚</div>
        </div>
        <div class="card">
          <div class="section-title">ğŸ“ å£ã‚³ãƒŸã‚’æŠ•ç¨¿</div>
          <form id="form">
            <div class="row">
              <div>
                <label>åº—å / ãƒã‚§ãƒ¼ãƒ³å</label>
                <input required id="name" placeholder="ä¾‹ï¼šãƒŸãƒ³ãƒˆã‚«ãƒ•ã‚§ æ¢…ç”°åº—"/>
              </div>
              <div>
                <label>ã‚¨ãƒªã‚¢</label>
                <input required id="area" placeholder="ä¾‹ï¼šå¤§é˜ªãƒ»æ¢…ç”°"/>
              </div>
            </div>
            <div class="row3">
              <div>
                <label>è·ç¨®</label>
                <input id="role" placeholder="ä¾‹ï¼šã‚«ãƒ•ã‚§/ãƒ¬ã‚¸/å“å‡ºã—"/>
              </div>
              <div>
                <label>æ™‚çµ¦ï¼ˆå††ï¼‰</label>
                <input id="wage" type="number" min="0" placeholder="ä¾‹ï¼š1100"/>
              </div>
              <div>
                <label>ä¼‘æ†©ï¼ˆåˆ†/1æ™‚é–“ã‚ãŸã‚Šï¼‰</label>
                <input id="breakPerHour" type="number" min="0" placeholder="ä¾‹ï¼š20"/>
              </div>
            </div>
            <div class="row3">
              <div>
                <label>ã‚¹ãƒãƒ›</label>
                <select id="phone"><option>å¸¸æ™‚OK</option><option>ä¼‘æ†©ã®ã¿</option><option>ä¸å¯</option></select>
              </div>
              <div>
                <label>å–«ç…™</label>
                <select id="smoke"><option>åº—å†…OK</option><option>å±‹å¤–OK</option><option>ä¸å¯</option></select>
              </div>
              <div>
                <label>ç®¡ç†ã®ã‚†ã‚‹ã•ï¼ˆ1å³ã€œ5ã‚†ã‚‹ï¼‰</label>
                <input id="management" type="number" min="1" max="5" value="3"/>
              </div>
            </div>
            <div class="row3">
              <div>
                <label>å¿™ã—ã•ï¼ˆ1ãƒ’ãƒã€œ5æ¿€å‹™ï¼‰</label>
                <input id="busy" type="number" min="1" max="5" value="3"/>
              </div>
              <div>
                <label>äººé–“é–¢ä¿‚ã®å¹³å’Œåº¦ï¼ˆ1æ‚ªã€œ5è‰¯ï¼‰</label>
                <input id="mood" type="number" min="1" max="5" value="3"/>
              </div>
              <div>
                <label>åŒ¿åãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </label>
                <input id="nick" placeholder="ä¾‹ï¼šã‚«ãƒ¢å¤ªéƒ"/>
              </div>
            </div>
            <div class="row">
              <div>
                <label>ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
                <input id="tags" placeholder="ä¾‹ï¼šæ”¾ç½®, æ·±å¤œãƒ’ãƒ, ã¾ã‹ãªã„"/>
              </div>
              <div>
                <label>å†™çœŸURLï¼ˆä»»æ„ï¼‰</label>
                <input id="photo" placeholder="https://â€¦"/>
              </div>
            </div>
            <div>
              <label>ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆå…·ä½“ä¾‹ãƒ»æ³¨æ„ç‚¹ãƒ»ã‚³ãƒ„ãªã©ï¼‰</label>
              <textarea id="comment" placeholder="ä¾‹ï¼šæ˜¼ãƒ”ãƒ¼ã‚¯ä»¥å¤–ã¯åŸºæœ¬ãƒ’ãƒã€‚å‹•ç”»è¦‹ã¦ã‚‚æ³¨æ„ã•ã‚Œãªã„ã€‚"></textarea>
              <small>æŠ•ç¨¿ã¯ã‚ãªãŸã®ç«¯æœ«ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚å¾Œã§JSONå‡ºåŠ›â†’å…±æœ‰ã§ã¿ã‚“ãªã®ç«¯æœ«ã«èª­ã¿è¾¼ã‚ã¾ã™ã€‚</small>
            </div>
            <div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap">
              <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="agree"/> æŠ•ç¨¿ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«åŒæ„</label>
              <button class="btn primary" type="submit">æŠ•ç¨¿ã—ã¦ä¿å­˜</button>
              <button class="btn" type="button" id="btnClear">å…¨æ¶ˆå»</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div>
      <div class="card">
        <div class="section-title">ğŸ“ˆ ã‚†ã‚‹ã•ã‚¹ã‚³ã‚¢ã¨ã¯ï¼Ÿ</div>
        <p class="hint">ä»¥ä¸‹ã®é‡ã¿ã§0ã€œ100ç‚¹åŒ–ã—ã¾ã™ï¼ˆÎ²ç‰ˆï¼‰ã€‚ã‚ã¨ã§èª¿æ•´å¯èƒ½ã€‚</p>
        <ul class="hint">
          <li>ä¼‘æ†©ã®å¤šã•ï¼š<b>35%</b>ï¼ˆ1hã‚ãŸã‚Šåˆ†æ•°ã‚’æ­£è¦åŒ–ã€æœ€å¤§30åˆ†ã§æº€ç‚¹ï¼‰</li>
          <li>ã‚¹ãƒãƒ›å¯ï¼š<b>15%</b>ï¼ˆå¸¸æ™‚OK=æº€ç‚¹ã€ä¼‘æ†©ã®ã¿=ä¸­ã€ä¸å¯=0ï¼‰</li>
          <li>å–«ç…™å¯ï¼š<b>5%</b>ï¼ˆåº—å†…>å±‹å¤–>ä¸å¯ï¼‰</li>
          <li>å¿™ã—ã•ã®ä½ã•ï¼š<b>15%</b>ï¼ˆ1ãŒæº€ç‚¹ï¼‰</li>
          <li>ç®¡ç†ã®ã‚†ã‚‹ã•ï¼š<b>20%</b>ï¼ˆ5ãŒæº€ç‚¹ï¼‰</li>
          <li>äººé–“é–¢ä¿‚ã®å¹³å’Œåº¦ï¼š<b>10%</b>ï¼ˆ5ãŒæº€ç‚¹ï¼‰</li>
        </ul>
        <p class="hint">â€»ã‚ãã¾ã§ä¸»è¦³å£ã‚³ãƒŸã€‚èª¹è¬—ä¸­å‚·ãƒ»æ©Ÿå¯†ãƒ»å€‹äººæƒ…å ±ã¯æ›¸ã‹ãªã„ã§ã­ã€‚</p>
      </div>
      <div class="card">
        <div class="section-title">ğŸ“¤ å…±æœ‰ã®ã—ã‹ãŸï¼ˆMVPï¼‰</div>
        <ol class="hint">
          <li>å³ä¸Šã€Œãƒ‡ãƒ¼ã‚¿å‡ºåŠ›ã€ã§JSONã‚’ä¿å­˜</li>
          <li>ä»–ã®ç«¯æœ«ã§ã€Œãƒ‡ãƒ¼ã‚¿èª­è¾¼ã€â†’ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã§åæ˜ </li>
          <li>GitHub Pagesã‚„Netlifyã«ã“ã®HTMLã‚’ç½®ã‘ã°å³å…¬é–‹</li>
        </ol>
        <div class="actions">
          <button class="btn" id="btnShare">ã“ã®ã‚¢ãƒ—ãƒªã‚’ã‚·ã‚§ã‚¢</button>
          <button class="btn" id="btnCopyHashtag">#ã‚«ãƒ¢ãƒã‚¤ãƒˆ ã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">Â© 2025 ã‚«ãƒ¢ãƒã‚¤ãƒˆï¼ˆMVPï¼‰ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã®ã¿ï¼ã‚µãƒ¼ãƒãƒ¼ä¸è¦ã€‚
      ãƒ»<a href="#" id="openGuideline">ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</a>
    </div>
  </footer>

  <template id="guidelineTpl">
    <div class="card" style="position:fixed;inset:auto 16px 16px 16px;max-width:900px;margin:0 auto;background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:14px;z-index:50">
      <b>æŠ•ç¨¿ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</b>
      <ul class="hint">
        <li>ä½“é¨“ãƒ™ãƒ¼ã‚¹ã®ä¸»è¦³ã§OKã€‚å€‹äººåã‚„æ©Ÿå¯†ã¯NGã€‚</li>
        <li>èª¹è¬—ä¸­å‚·ã‚„æ–­å®šçš„ãªè¡¨ç¾ã¯é¿ã‘ã€äº‹å®Ÿã¨æ„Ÿæƒ³ã‚’åˆ†ã‘ã‚‹ã€‚</li>
        <li>å‰Šé™¤å¸Œæœ›ã¯ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›â†’é‹å–¶ã¸å…±æœ‰ï¼ˆä»Šã¯ãƒ­ãƒ¼ã‚«ãƒ«ç‰ˆï¼‰ã€‚</li>
      </ul>
      <div style="display:flex;justify-content:flex-end"><button class="btn" id="closeGuide">é–‰ã˜ã‚‹</button></div>
    </div>
  </template>

  <script>
    // ---- Theme ----
    const themeBtn = document.getElementById('btnTheme');
    const savedTheme = localStorage.getItem('kamobaito:theme');
    if(savedTheme){ document.documentElement.setAttribute('data-theme', savedTheme); }
    themeBtn.addEventListener('click', ()=>{
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur==='light'?'dark':'light';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('kamobaito:theme', next);
    });

    // ---- Storage helpers ----
    const KEY = "kamobaito:v2"; // v2: tags/report/theme
    const store = {
      all(){ try{ return JSON.parse(localStorage.getItem(KEY)||"[]"); }catch(e){ return [] }},
      save(list){ localStorage.setItem(KEY, JSON.stringify(list)); },
      push(item){ const list = store.all(); list.unshift(item); store.save(list); }
    }

    // ---- Scoring ----
    function scoreOf(item){
      const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
      const normBreak = clamp((item.breakPerHour||0)/30,0,1);
      const phone = item.phone||"ä¼‘æ†©ã®ã¿";
      const phoneScore = phone==="å¸¸æ™‚OK"?1: phone==="ä¼‘æ†©ã®ã¿"?0.5:0;
      const smoke = item.smoke||"ä¸å¯";
      const smokeScore = smoke==="åº—å†…OK"?1: smoke==="å±‹å¤–OK"?0.6:0;
      const busy = clamp((item.busy||3),1,5);
      const busyScore = 1 - (busy-1)/4;
      const mgmt = clamp((item.management||3),1,5)/5;
      const mood = clamp((item.mood||3),1,5)/5;
      const score = (
        normBreak * 35 + phoneScore * 15 + smokeScore * 5 + busyScore * 15 + mgmt * 20 + mood * 10
      );
      return Math.round(score);
    }

    // ---- Render list ----
    const $list = document.getElementById('list');
    const $empty = document.getElementById('empty');

    function fmt(x){ return x==null || x==="" ? "-" : x }

    function tagBadges(tags){
      if(!tags || !tags.length) return '';
      return tags.slice(0,6).map(t=>`<span class="badge tag">${escapeHtml(t)}</span>`).join('');
    }

    function render(){
      const q = document.getElementById('q').value.trim().toLowerCase();
      const fPhone = document.getElementById('fPhone').value;
      const fSmoke = document.getElementById('fSmoke').value;
      const minScore = +document.getElementById('minScore').value || 0;
      const minBreak = +document.getElementById('minBreak').value || 0;
      const maxBusy = +document.getElementById('maxBusy').value || 5;
      const sort = document.getElementById('fSort').value;
      const limit = +document.getElementById('limit').value;

      let data = store.all().map(d=>({...d, score: d.score ?? scoreOf(d)}));

      // Filter
      data = data.filter(d=>{
        const hay = [d.name,d.area,d.role,(d.tags||[]).join(' ')].filter(Boolean).join(' ').toLowerCase();
        const hit = hay.includes(q);
        const okPhone = fPhone? d.phone===fPhone : true;
        const okSmoke = fSmoke? d.smoke===fSmoke : true;
        const okScore = (d.score>=minScore);
        const okBreak = (+(d.breakPerHour||0) >= minBreak);
        const okBusy = (+(d.busy||5) <= maxBusy);
        return hit && okPhone && okSmoke && okScore && okBreak && okBusy && !d.reported;
      });

      // Sort
      if(sort==='score') data.sort((a,b)=>b.score-a.score);
      if(sort==='new') data.sort((a,b)=> (b.created||0)-(a.created||0));
      if(sort==='break') data.sort((a,b)=> (b.breakPerHour||0)-(a.breakPerHour||0));

      data = data.slice(0, limit);

      $list.innerHTML = '';
      if(!data.length){ $empty.style.display='block'; return; }
      $empty.style.display='none';

      for(const d of data){
        const div = document.createElement('div');
        div.className='item';
        const badges = [];
        if(d.breakPerHour>0) badges.push(`ä¼‘æ†© ${d.breakPerHour}åˆ†/h`);
        if(d.phone) badges.push(`ã‚¹ãƒãƒ› ${d.phone}`);
        if(d.smoke) badges.push(`å–«ç…™ ${d.smoke}`);
        if(d.wage) badges.push(`æ™‚çµ¦ Â¥${d.wage}`);
        badges.push(`å¿™ã—ã• ${d.busy??'-'}`);
        badges.push(`ç®¡ç†ã‚†ã‚‹ã• ${d.management??'-'}`);
        badges.push(`äººé–“é–¢ä¿‚ ${d.mood??'-'}`);

        const img = d.photo? `<img src="${escapeHtml(d.photo)}" alt="photo" style="width:100%;max-height:160px;object-fit:cover;border-radius:12px;border:1px solid var(--border);margin:6px 0">` : '';

        div.innerHTML = `
          <div>
            <h3>${escapeHtml(d.name||'ï¼ˆç„¡é¡Œï¼‰')} <small class="hint">${escapeHtml(d.area||'')}</small></h3>
            <div class="badges">${badges.map(b=>`<span class="badge">${escapeHtml(b)}</span>`).join('')} ${tagBadges(d.tags)}</div>
            ${img}
            <p class="hint" style="margin:8px 0 0">${escapeHtml(d.comment||'')}</p>
            <p class="hint" style="margin:6px 0 0">æŠ•ç¨¿è€…ï¼š${escapeHtml(d.nick||'åŒ¿å')}ãƒ»${new Date(d.created||Date.now()).toLocaleString()}</p>
            <div class="actions">
              <button class="btn" data-share>ã‚·ã‚§ã‚¢</button>
              <button class="btn" data-report>${d.reported? 'é€šå ±æ¸ˆ' : 'é€šå ±'}</button>
              <button class="btn" data-copy>æ¡ä»¶ã‚’ã‚³ãƒ”ãƒ¼</button>
            </div>
          </div>
          <div class="scorewrap">
            <div class="score" style="--val:${d.score}"><b>${d.score}</b></div>
          </div>
        `;

        div.querySelector('[data-share]').addEventListener('click', ()=>sharePost(d));
        div.querySelector('[data-report]').addEventListener('click', (ev)=>reportPost(d, ev.currentTarget));
        div.querySelector('[data-copy]').addEventListener('click', ()=>copyQuery(d));

        $list.appendChild(div);
      }
    }

    function escapeHtml(s){
      return (s||'').replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))
    }

    // ---- Share helpers ----
    async function sharePost(d){
      const text = `ã‚«ãƒ¢ãƒã‚¤ãƒˆï¼š${d.name}ï¼ˆ${d.area}ï¼‰
ã‚†ã‚‹ã•ã‚¹ã‚³ã‚¢ ${d.score} / 100
#ã‚«ãƒ¢ãƒã‚¤ãƒˆ`;
      const url = location.href;
      if(navigator.share){ try{ await navigator.share({title:'ã‚«ãƒ¢ãƒã‚¤ãƒˆ', text, url}); }catch(e){} }
      else { await navigator.clipboard.writeText(text+"
"+url); alert('å…±æœ‰ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'); }
    }

    async function copyQuery(d){
      const params = new URLSearchParams({ q: [d.name,d.area].filter(Boolean).join(' ') });
      const link = location.origin + location.pathname + '?' + params.toString();
      await navigator.clipboard.writeText(link);
      alert('ã“ã®æ¡ä»¶ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
    }

    function reportPost(d, btn){
      if(!confirm('ã“ã®æŠ•ç¨¿ã‚’é€šå ±ã—ã¾ã™ã‹ï¼Ÿï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã§éè¡¨ç¤ºã«ãªã‚Šã¾ã™ï¼‰')) return;
      const list = store.all();
      const i = list.findIndex(x=>x.id===d.id);
      if(i>=0){ list[i].reported = true; store.save(list); }
      btn.textContent = 'é€šå ±æ¸ˆ';
      render();
    }

    // ---- Form events ----
    document.getElementById('form').addEventListener('submit', (e)=>{
      e.preventDefault();
      if(!document.getElementById('agree').checked){ alert('ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«åŒæ„ã—ã¦ãã ã•ã„'); return; }
      const rawTags = document.getElementById('tags').value.trim();
      const item = {
        id: crypto.randomUUID(),
        name: document.getElementById('name').value.trim(),
        area: document.getElementById('area').value.trim(),
        role: document.getElementById('role').value.trim(),
        wage: +(document.getElementById('wage').value||0),
        breakPerHour: +(document.getElementById('breakPerHour').value||0),
        phone: document.getElementById('phone').value,
        smoke: document.getElementById('smoke').value,
        management: +(document.getElementById('management').value||3),
        busy: +(document.getElementById('busy').value||3),
        mood: +(document.getElementById('mood').value||3),
        nick: document.getElementById('nick').value.trim(),
        comment: document.getElementById('comment').value.trim(),
        tags: rawTags? rawTags.split(',').map(s=>s.trim()).filter(Boolean) : [],
        photo: document.getElementById('photo').value.trim(),
        created: Date.now()
      }
      item.score = scoreOf(item);
      if(!item.name || !item.area){ alert('åº—åã¨ã‚¨ãƒªã‚¢ã¯å¿…é ˆã§ã™'); return; }
      store.push(item);
      (e.target).reset();
      render();
    });

    document.getElementById('btnClear').addEventListener('click', ()=>{
      if(confirm('ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã¦å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')){
        localStorage.removeItem(KEY);
        render();
      }
    });

    // ---- Filters
    ['q','fPhone','fSmoke','minScore','minBreak','maxBusy','fSort','limit'].forEach(id=>{
      document.getElementById(id).addEventListener('input', render);
      document.getElementById(id).addEventListener('change', render);
    });

    // ---- Import/Export ----
    document.getElementById('btnExport').addEventListener('click', ()=>{
      const data = store.all();
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = Object.assign(document.createElement('a'), {href:url, download:'kamobaito-data.json'});
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    document.getElementById('btnImport').addEventListener('click', ()=>{
      const input = Object.assign(document.createElement('input'), {type:'file', accept:'application/json'});
      input.onchange = () => {
        const file = input.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try{
            const arr = JSON.parse(reader.result);
            if(!Array.isArray(arr)) throw new Error('å½¢å¼ãŒä¸æ­£ã§ã™');
            const current = store.all();
            const ids = new Set(current.map(x=>x.id));
            const merged = [...current, ...arr.filter(x=>!ids.has(x.id))];
            store.save(merged);
            render();
          }catch(e){ alert('èª­ã¿è¾¼ã¿å¤±æ•—ï¼š'+e.message) }
        }
        reader.readAsText(file);
      }
      input.click();
    });

    // ---- Mock data ----
    document.getElementById('btnMock').addEventListener('click', ()=>{
      if(!confirm('ãƒ‡ãƒ¢ç”¨ã‚µãƒ³ãƒ—ãƒ«æŠ•ç¨¿ã‚’è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ')) return;
      const samples = [
        {name:'ãƒ‰ãƒªãƒƒãƒ—ã‚«ãƒ•ã‚§ å¿ƒæ–æ©‹', area:'å¤§é˜ªãƒ»å¿ƒæ–æ©‹', role:'ã‚«ãƒ•ã‚§', wage:1100, breakPerHour:20, phone:'å¸¸æ™‚OK', smoke:'å±‹å¤–OK', management:5, busy:2, mood:4, tags:['æ”¾ç½®','å‹•ç”»OK'], nick:'çˆç²æ°‘', comment:'æ˜¼ãƒ”ãƒ¼ã‚¯ä»¥å¤–ã¯åŸºæœ¬ãƒ’ãƒã€‚å‹•ç”»è¦‹ã¦ã‚‚æ³¨æ„ã•ã‚Œãªã„ã€‚'},
        {name:'ãƒ¡ã‚¬ãƒ‰ãƒ³ã‚­ ç”ºç”°', area:'æ±äº¬ãƒ»ç”ºç”°', role:'å“å‡ºã—', wage:1200, breakPerHour:10, phone:'ä¼‘æ†©ã®ã¿', smoke:'ä¸å¯', management:3, busy:3, mood:3, tags:['å¤œå‹¤','è‡ªç”±åº¦é«˜'], nick:'å¤œå‹¤å‹¢', comment:'å¤œå‹¤ã¯ã‹ãªã‚Šè‡ªç”±ã€‚åº—é•·æ”¾ç½®æ°—å‘³ã€‚'},
        {name:'ã‚«ãƒ©ã‚ªã‚± JOYO å¤©ç¥', area:'ç¦å²¡ãƒ»å¤©ç¥', role:'ãƒ•ãƒ­ã‚¢', wage:1050, breakPerHour:15, phone:'å¸¸æ™‚OK', smoke:'åº—å†…OK', management:4, busy:3, mood:4, tags:['æ·±å¤œãƒ’ãƒ','ã‚¿ãƒã‚³OK'], nick:'ã‚«ãƒ©æ°‘', comment:'æ·±å¤œå¸¯ã¯ã»ã¼ã‚¹ãƒãƒ›ã‚¿ã‚¤ãƒ ã€‚ã‚¿ãƒã‚³OKã€‚'},
        {name:'ãƒ›ãƒ¼ãƒ ã‚»ãƒ³ã‚¿ãƒ¼K åŠ å¤å·', area:'å…µåº«ãƒ»åŠ å¤å·', role:'ãƒ¬ã‚¸', wage:1030, breakPerHour:5, phone:'ä¸å¯', smoke:'å±‹å¤–OK', management:2, busy:4, mood:3, tags:['åœŸæ—¥æ¿€å‹™'], nick:'ãƒ¬ã‚¸ã£å­', comment:'åœŸæ—¥ã¯æ¿€å‹™ã§ã‚†ã‚‹ããªã„ã€‚å¹³æ—¥å¤•æ–¹ã¯ãƒã‚·ã€‚'}
      ];
      const now = Date.now();
      const withMeta = samples.map((s,i)=>({id:crypto.randomUUID(),...s, created: now - i*3600_000})).map(s=>({...s, score: scoreOf(s)}));
      const merged = [...withMeta, ...store.all()];
      store.save(merged); render();
    });

    // ---- Share UI ----
    document.getElementById('btnShare').addEventListener('click', async ()=>{
      const text = 'â€œå…¥ã£ã¦ã¿ãªã„ã¨åˆ†ã‹ã‚‰ãªã„æ¥½ã•â€ã§æ¢ã›ã‚‹ #ã‚«ãƒ¢ãƒã‚¤ãƒˆ Î²å…¬é–‹ï¼';
      const url = location.href;
      if(navigator.share){ try{ await navigator.share({title:'ã‚«ãƒ¢ãƒã‚¤ãƒˆ', text, url}); }catch(e){} }
      else { await navigator.clipboard.writeText(text+"
"+url); alert('ç´¹ä»‹ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'); }
    });
    document.getElementById('btnCopyHashtag').addEventListener('click', async ()=>{
      await navigator.clipboard.writeText('#ã‚«ãƒ¢ãƒã‚¤ãƒˆ #æ¥½ãƒã‚¤ãƒˆ #è£ãƒã‚¤ãƒˆæƒ…å ±');
      alert('ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
    });

    // ---- Guideline modal ----
    document.getElementById('openGuideline').addEventListener('click', (e)=>{
      e.preventDefault();
      const tpl = document.getElementById('guidelineTpl');
      const node = tpl.content.cloneNode(true);
      document.body.appendChild(node);
      document.getElementById('closeGuide').addEventListener('click', ()=>{
        document.querySelectorAll('#closeGuide').forEach(()=>{}); // noop
        const cards = Array.from(document.querySelectorAll('body > .card')); // naive
      });
      // remove on click
      document.querySelector('body > .card:last-of-type button#closeGuide').addEventListener('click', (ev)=>{
        ev.target.closest('.card').remove();
      });
    });

    // First paint
    function applyQueryFromURL(){
      const u = new URL(location.href);
      const q = u.searchParams.get('q');
      if(q){ document.getElementById('q').value = q; }
    }
    applyQueryFromURL();
    render();
  </script>
</body>
</html>
